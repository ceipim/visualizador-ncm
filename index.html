<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de NCM - Códigos de 8 Dígitos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .options-section {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }
        
        .option-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .option-tab {
            padding: 12px 20px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            color: #7f8c8d;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .option-tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }
        
        .option-tab:hover {
            color: #2980b9;
        }
        
        .option-content {
            display: none;
        }
        
        .option-content.active {
            display: block;
        }
        
        .file-section {
            text-align: center;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }
        
        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-button {
            display: inline-block;
            padding: 12px 30px;
            background: #3498db;
            color: white;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        
        .file-input-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(52, 152, 219, 0.4);
        }
        
        .file-name {
            margin-top: 15px;
            font-style: italic;
            color: #555;
        }
        
        .github-upload {
            margin-top: 30px;
            padding: 20px;
            background: #f1f8ff;
            border-radius: 8px;
            border-left: 4px solid #0366d6;
        }
        
        .github-upload h3 {
            color: #0366d6;
            margin-bottom: 15px;
        }
        
        .github-upload p {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .github-upload ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .github-upload li {
            margin-bottom: 8px;
        }
        
        .github-upload code {
            background: #e1e4e8;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .check-section {
            text-align: center;
        }
        
        .check-input {
            padding: 12px 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
            max-width: 600px;
            margin-bottom: 15px;
        }
        
        .check-button {
            display: inline-block;
            padding: 12px 30px;
            background: #27ae60;
            color: white;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3);
            border: none;
            font-size: 1rem;
        }
        
        .check-button:hover {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(39, 174, 96, 0.4);
        }
        
        .check-results {
            margin-top: 20px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .results-table thead {
            background-color: #2c3e50;
            color: white;
        }
        
        .results-table th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .results-table tbody tr {
            border-bottom: 1px solid #eee;
        }
        
        .results-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .results-table tbody tr:hover {
            background-color: #e9ecef;
        }
        
        .results-table td {
            padding: 12px 15px;
        }
        
        .results-table .row-number {
            font-weight: bold;
            color: #6c757d;
            width: 50px;
            text-align: center;
        }
        
        .results-table .ncm-code {
            font-weight: bold;
            font-family: 'Courier New', monospace;
            width: 120px;
        }
        
        .results-table .status {
            font-weight: bold;
            width: 120px;
        }
        
        .results-table .description {
            max-width: 400px;
        }
        
        .results-table .found {
            color: #155724;
            background-color: rgba(40, 167, 69, 0.1);
        }
        
        .results-table .not-found {
            color: #721c24;
            background-color: rgba(220, 53, 69, 0.1);
        }
        
        .check-summary {
            margin-top: 20px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
            text-align: center;
            display: none;
        }
        
        .check-summary.show {
            display: block;
        }
        
        .check-summary .total {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .check-summary .found {
            color: #28a745;
        }
        
        .check-summary .not-found {
            color: #dc3545;
        }
        
        .info-section {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .data-block {
            flex: 1;
            min-width: 250px;
            margin: 10px;
        }
        
        .data-title {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .data-value {
            font-size: 1.5rem;
            color: #e74c3c;
            font-weight: bold;
        }
        
        .ncm-section {
            padding: 30px;
        }
        
        .ncm-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .ncm-list {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .ncm-item {
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
            transition: all 0.2s ease;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .ncm-item:hover {
            background: #e8f4fc;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .ncm-code {
            font-weight: bold;
            color: #2980b9;
            display: block;
            font-size: 1.2rem;
            margin-bottom: 8px;
        }
        
        .ncm-description {
            color: #333;
            font-size: 0.95rem;
        }
        
        .hidden {
            display: none;
        }
        
        .error-message {
            color: #e74c3c;
            background: #fadbd8;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border-left: 4px solid #e74c3c;
        }
        
        .filter-info {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border-left: 4px solid #3498db;
            color: #2980b9;
        }
        
        .success-message {
            color: #27ae60;
            background: #d4edda;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border-left: 4px solid #27ae60;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #2c3e50;
            color: white;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .info-section {
                flex-direction: column;
            }
            
            .ncm-list {
                grid-template-columns: 1fr;
            }
            
            .option-tabs {
                flex-direction: column;
                border-bottom: none;
            }
            
            .option-tab {
                border-bottom: none;
                border-left: 3px solid transparent;
                text-align: left;
            }
            
            .option-tab.active {
                border-left-color: #3498db;
                border-bottom-color: transparent;
            }
            
            .check-input {
                margin-bottom: 15px;
            }
            
            .results-table {
                font-size: 0.9rem;
            }
            
            .results-table th,
            .results-table td {
                padding: 8px 10px;
            }
            
            .results-table .description {
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Visualizador de NCM</h1>
            <div class="subtitle">Códigos de 8 Dígitos da Nomenclatura Comum do Mercosul</div>
        </header>
        
        <section class="options-section">
            <div class="option-tabs">
                <button class="option-tab active" data-tab="update">Atualizar Base de Dados das NCMs</button>
                <button class="option-tab" data-tab="check">Checar NCMs</button>
            </div>
            
            <div class="option-content active" id="update-content">
                <div class="file-section">
                    <h2>Atualizar Base de Dados</h2>
                    <p>Selecione um arquivo JSON para atualizar a base de dados de NCMs</p>
                    
                    <div class="file-input-wrapper">
                        <input type="file" id="fileInput" class="file-input" accept=".json">
                        <label for="fileInput" class="file-input-button">Escolher Arquivo</label>
                    </div>
                    <div class="file-name" id="fileName">Nenhum arquivo selecionado</div>
                </div>
                
                <div class="github-upload">
                    <h3>Como enviar o arquivo para o GitHub</h3>
                    <p>Para que o arquivo seja usado pelo código, você precisa enviá-lo para o seu repositório GitHub:</p>
                    <ol>
                        <li>Faça login no sua conta do GitHub</li>
                        <li>Acesse o repositório onde os dados serão armazenados</li>
                        <li>Clique no botão <code>Add file</code> e depois <code>Upload files</code></li>
                        <li>Arraste o arquivo JSON para a área de upload ou clique para selecionar</li>
                        <li>Dê um nome para o arquivo (ex: <code>ncm_data.json</code>)</li>
                        <li>Adicione uma mensagem de commit (ex: "Atualização da base de dados NCM")</li>
                        <li>Clique em <code>Commit changes</code> para finalizar</li>
                    </ol>
                    <p><strong>Importante:</strong> Após enviar o arquivo para o GitHub, atualize a variável <code>GITHUB_RAW_URL</code> no código JavaScript com a URL do seu arquivo.</p>
                </div>
            </div>
            
            <div class="option-content" id="check-content">
                <div class="check-section">
                    <h2>Checar NCMs</h2>
                    <p>Digite um ou mais códigos NCM de 8 dígitos separados por vírgula</p>
                    
                    <input type="text" id="ncmInput" class="check-input" placeholder="Ex: 9706.10.00, 9406.90.00, 0101.21.00">
                    <button id="checkButton" class="check-button">Checar NCMs</button>
                    
                    <div id="checkResults" class="check-results"></div>
                    <div id="checkSummary" class="check-summary"></div>
                </div>
            </div>
        </section>
        
        <section class="info-section hidden" id="infoSection">
            <div class="data-block">
                <h2 class="data-title">Data de Atualização da NCM</h2>
                <div class="data-value" id="dataAtualizacao"></div>
            </div>
            <div class="data-block">
                <h2 class="data-title">Total de Códigos de 8 Dígitos</h2>
                <div class="data-value" id="totalCodigos">0</div>
            </div>
        </section>
        
        <div class="filter-info hidden" id="filterInfo">
            Exibindo apenas códigos NCM com 8 dígitos (formato XXXX.XX.XX)
        </div>
        
        <section class="ncm-section hidden" id="ncmSection">
            <h2 class="ncm-title">Códigos NCM de 8 Dígitos</h2>
            <ul class="ncm-list" id="ncmList"></ul>
        </section>
        
        <div class="error-message hidden" id="errorMessage"></div>
        <div class="success-message hidden" id="successMessage"></div>
        
        <footer>
            <p>© 2023 - Visualizador de NCM | Desenvolvido para análise de dados do Mercosul</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Configuração da URL do arquivo JSON no GitHub
            // SUBSTITUA ESTA URL PELA URL DO SEU ARQUIVO NO GITHUB
            const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/seu-usuario/seu-repositorio/main/ncm_data.json';
            
            // Variável para armazenar a base de dados
            let baseDadosNCM = null;
            
            // Elementos da interface
            const optionTabs = document.querySelectorAll('.option-tab');
            const optionContents = document.querySelectorAll('.option-content');
            
            // Elementos do arquivo
            const fileInput = document.getElementById('fileInput');
            const fileName = document.getElementById('fileName');
            
            // Elementos de checagem
            const ncmInput = document.getElementById('ncmInput');
            const checkButton = document.getElementById('checkButton');
            const checkResults = document.getElementById('checkResults');
            const checkSummary = document.getElementById('checkSummary');
            
            // Elementos de resultado
            const infoSection = document.getElementById('infoSection');
            const ncmSection = document.getElementById('ncmSection');
            const filterInfo = document.getElementById('filterInfo');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const dataAtualizacao = document.getElementById('dataAtualizacao');
            const totalCodigos = document.getElementById('totalCodigos');
            const ncmList = document.getElementById('ncmList');
            
            // Gerenciamento de abas
            optionTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Desativar todas as abas
                    optionTabs.forEach(t => t.classList.remove('active'));
                    optionContents.forEach(c => c.classList.remove('active'));
                    
                    // Ativar a aba selecionada
                    tab.classList.add('active');
                    document.getElementById(`${tabId}-content`).classList.add('active');
                });
            });
            
            // Função para limpar o cache do localStorage
            function limparCache() {
                try {
                    // Limpar todos os itens do localStorage relacionados ao NCM
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key && key.includes('ncm')) {
                            localStorage.removeItem(key);
                        }
                    }
                    console.log('Cache do NCM limpo com sucesso');
                } catch (error) {
                    console.error('Erro ao limpar cache:', error);
                }
            }
            
            // Função para processar os dados JSON
            function processarDados(jsonData) {
                try {
                    // Verificar se o JSON tem a estrutura esperada
                    if (!jsonData.Data_Ultima_Atualizacao_NCM || !jsonData.Nomenclaturas) {
                        throw new Error("Estrutura do JSON inválida");
                    }
                    
                    // Armazenar os dados na variável global
                    baseDadosNCM = jsonData;
                    
                    // Exibir data de atualização
                    dataAtualizacao.textContent = jsonData.Data_Ultima_Atualizacao_NCM;
                    
                    // Filtrar apenas códigos de 8 dígitos
                    const codigos8Digitos = jsonData.Nomenclaturas.filter(item => {
                        // Remover pontos e verificar se tem exatamente 8 dígitos
                        const codigoSemPontos = item.Codigo.replace(/\./g, '');
                        return codigoSemPontos.length === 8;
                    });
                    
                    // Exibir total de códigos encontrados
                    totalCodigos.textContent = codigos8Digitos.length;
                    
                    // Limpar lista anterior
                    ncmList.innerHTML = '';
                    
                    // Ordenar os códigos numericamente
                    codigos8Digitos.sort((a, b) => {
                        const codigoA = a.Codigo.replace(/\./g, '');
                        const codigoB = b.Codigo.replace(/\./g, '');
                        return codigoA.localeCompare(codigoB);
                    });
                    
                    // Processar e exibir itens da NCM
                    codigos8Digitos.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'ncm-item';
                        
                        li.innerHTML = `
                            <span class="ncm-code">${item.Codigo}</span>
                            <span class="ncm-description">${item.Descricao}</span>
                        `;
                        
                        ncmList.appendChild(li);
                    });
                    
                    // Exibir seções
                    infoSection.classList.remove('hidden');
                    filterInfo.classList.remove('hidden');
                    ncmSection.classList.remove('hidden');
                    errorMessage.classList.add('hidden');
                    
                } catch (error) {
                    errorMessage.textContent = `Erro ao processar dados: ${error.message}`;
                    errorMessage.classList.remove('hidden');
                    infoSection.classList.add('hidden');
                    filterInfo.classList.add('hidden');
                    ncmSection.classList.add('hidden');
                    console.error('Erro:', error);
                }
            }
            
            // Função para carregar dados do GitHub
            function carregarDadosGitHub() {
                errorMessage.classList.add('hidden');
                
                fetch(GITHUB_RAW_URL)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Erro ao carregar arquivo: ${response.status} ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        processarDados(data);
                        successMessage.textContent = "Dados carregados com sucesso do GitHub!";
                        successMessage.classList.remove('hidden');
                        setTimeout(() => {
                            successMessage.classList.add('hidden');
                        }, 3000);
                    })
                    .catch(error => {
                        errorMessage.textContent = `Erro ao carregar dados do GitHub: ${error.message}`;
                        errorMessage.classList.remove('hidden');
                        console.error('Erro:', error);
                    });
            }
            
            // Evento para carregar arquivo
            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                fileName.textContent = file.name;
                errorMessage.classList.add('hidden');
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        processarDados(jsonData);
                        successMessage.textContent = "Base de dados atualizada com sucesso! Lembre-se de enviar este arquivo para o GitHub.";
                        successMessage.classList.remove('hidden');
                        setTimeout(() => {
                            successMessage.classList.add('hidden');
                        }, 5000);
                    } catch (error) {
                        errorMessage.textContent = `Erro ao processar o arquivo: ${error.message}`;
                        errorMessage.classList.remove('hidden');
                    }
                };
                
                reader.readAsText(file);
            });
            
            // Evento para checar NCMs
            checkButton.addEventListener('click', function() {
                const ncmCodes = ncmInput.value.trim();
                if (!ncmCodes) {
                    checkResults.innerHTML = '<div class="error-message">Por favor, digite pelo menos um código NCM</div>';
                    checkSummary.classList.remove('show');
                    return;
                }
                
                if (!baseDadosNCM) {
                    checkResults.innerHTML = '<div class="error-message">Nenhuma base de dados carregada. Por favor, atualize a base primeiro.</div>';
                    checkSummary.classList.remove('show');
                    return;
                }
                
                // Dividir os códigos por vírgula e remover espaços extras
                const codesArray = ncmCodes.split(',').map(code => code.trim()).filter(code => code);
                
                // Limpar resultados anteriores
                checkResults.innerHTML = '';
                
                let foundCount = 0;
                let notFoundCount = 0;
                
                // Criar tabela
                const table = document.createElement('table');
                table.className = 'results-table';
                
                // Criar cabeçalho
                const thead = document.createElement('thead');
                thead.innerHTML = `
                    <tr>
                        <th>#</th>
                        <th>Código NCM</th>
                        <th>Status</th>
                        <th>Descrição</th>
                    </tr>
                `;
                table.appendChild(thead);
                
                // Criar corpo
                const tbody = document.createElement('tbody');
                
                // Verificar cada código
                codesArray.forEach((code, index) => {
                    // Normalizar o código (remover pontos e espaços)
                    const normalizedCode = code.replace(/[\.\s]/g, '');
                    
                    // Procurar o código na base de dados
                    const foundItem = baseDadosNCM.Nomenclaturas.find(item => {
                        const itemCode = item.Codigo.replace(/\./g, '');
                        return itemCode === normalizedCode && itemCode.length === 8;
                    });
                    
                    // Criar linha da tabela
                    const row = document.createElement('tr');
                    
                    if (foundItem) {
                        foundCount++;
                        row.innerHTML = `
                            <td class="row-number">${index + 1}</td>
                            <td class="ncm-code">${foundItem.Codigo}</td>
                            <td class="status found">ENCONTRADO</td>
                            <td class="description">${foundItem.Descricao}</td>
                        `;
                    } else {
                        notFoundCount++;
                        row.innerHTML = `
                            <td class="row-number">${index + 1}</td>
                            <td class="ncm-code">${code}</td>
                            <td class="status not-found">NÃO ENCONTRADO</td>
                            <td class="description">O código NCM "${code}" não existe na base de dados.</td>
                        `;
                    }
                    
                    tbody.appendChild(row);
                });
                
                table.appendChild(tbody);
                checkResults.appendChild(table);
                
                // Exibir resumo
                if (codesArray.length > 1) {
                    checkSummary.innerHTML = `
                        <div class="total">Total verificado: ${codesArray.length} códigos</div>
                        <div class="found">Encontrados: ${foundCount}</div>
                        <div class="not-found">Não encontrados: ${notFoundCount}</div>
                    `;
                    checkSummary.classList.add('show');
                } else {
                    checkSummary.classList.remove('show');
                }
            });
            
            // Permitir checar com Enter
            ncmInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkButton.click();
                }
            });
            
            // Inicialização
            function inicializar() {
                // Limpar o cache sempre que o site for carregado
                limparCache();
                
                // Carregar dados do GitHub
                carregarDadosGitHub();
            }
            
            // Iniciar o aplicativo
            inicializar();
        });
    </script>
</body>
</html>